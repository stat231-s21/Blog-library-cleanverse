---
title: "COVID-19 Vaccinations in the United States: A Study"
author: "Amaya Smole, Clara Page, Kriti Verma"
date: "5/11/2021"
output:
  rmdformats::readthedown:
    thumbnails: false
    highlight: NULL
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align="center")
library(tidyverse)
library(rvest)
library(dplyr)
library(robotstxt)
library(datasets)
library(viridis)
library(maps)
library(leaflet)
library(ggnewscale)
library(gridExtra)
```

# Project Description

## Introduction

### Results

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For example, you can include **Bold** and _Italic_ and `Code` text.  For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

You should test out updating your GitHub Pages website:

- clone your group's blog project repo in RStudio
- update "Your Project Title Here" to a new title in the YAML header
- knit `index.Rmd` 
- commit and push BOTH the `index.Rmd` and the `index.html` files
- go to https://stat231-s21.github.io/Blog-library-cleanverse/ to see the published test document (this is publicly available!)

## Including code and plots

You can embed code as normal, for example:

```{r cars}
summary(cars)
```

Let's clean up the format of that output:

```{r pretty, echo=FALSE, warning=FALSE, message=FALSE, eval=FALSE}
library(kableExtra)
summary(cars) %>%
  kable(col.names = c("Speed", "Distance")
        , row.names = F) %>%
  kable_styling(bootstrap_options = "striped"
                , full_width = F) %>%
  row_spec(0, bold = T, underline = T) %>%
  column_spec(1:2, width = "1.5in") 
```

In a study from the 1920s, fifty cars were used to see how the speed of the car and the distance taken to stop were related.  Speeds ranged between `r min(cars$speed)` and `r max(cars$speed)` mph.  Distances taken to stop ranged between `r min(cars$dist)` and `r max(cars$dist)` feet, with the middle 50% falling between `r as.numeric(quantile(cars$dist)[2])` and `r as.numeric(quantile(cars$dist)[4])` feet.  

You can also embed plots as normal, for example:

```{r figure1, echo=FALSE}
ggplot(data = cars, aes(x = speed, y = dist)) + 
  geom_point() + 
  labs(x = "Speed of car (mph)"
       , y = "Distance taken to stop (ft)"
       , title = "cars data (1920s)")
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


## Including links and images

You can include [Links](https://www.datadreaming.org/post/r-markdown-theme-gallery/) and images ![team logo](https://raw.githubusercontent.com/stat231-s21/Blog-library-cleanverse/main/images/s1g6-publichealth.png?token=AGMTX5XTR6OSIG2YBI4FWT3AOVTZU)

You can embed a gif.  

![ma example](https://raw.githubusercontent.com/stat231-s21/Blog-library-cleanverse/main/kriti/ma_example.gif)

![usa vaccine number](https://raw.githubusercontent.com/stat231-s21/Blog-library-cleanverse/main/kriti/usa_vaccine_number.gif)

# Comparison: CA and TN {.tabset .tabset-fade .tabset-pills}

An issue central to policy response to the COVID-19 pandemic is how to efficiently, equitably, and safely administered vaccinations among subpopulations of a given country's citizens. Especially given the race-related events, movements, and justice and injustices in the past year, equitable vaccine distribution among racial groups is a very important, highly studied topic. Below, we will analyze vaccine administration by race in California and Tennessee, two historically partisan states, to see how well racially just policies and public health hopes are faring as they are put into practice. To calculate the proportion of racial groups, I scaled vaccine counts by racial subpopulations in California and Tennessee. 

```{r, echo = FALSE, message = FALSE}
# read in and plot ca vax over time
library(tidyverse)
library(dplyr)
library(readxl)
library(scales)
library(viridis)
library(ggpubr)
library(ggplot2)

ca_time <- read_csv("ca_time.csv") %>%
  filter(race != "Unknown", race != "Other/Multiracial")
ca_tg <- ggplot(ca_time, aes(x = date, y = frac, colour = Race)) +
  geom_line() +
  xlab("Date") + ylab("Proportion of Racial Group") +
  theme(legend.position = "bottom") +
  theme(legend.title = element_blank())
# read in and plot tn vax over time 
tn_time <- read_csv("tn_time.csv") %>%
  filter(race != "UNKNOWN", race != "OTHER/MULTIRACIAL")
tn_tg <- ggplot(tn_time, aes(x = date, y = frac, colour = Race)) +
  geom_line() +
  xlab("Date") + ylab("Proportion of Racial Group")+
  theme(legend.position = "bottom") +
  theme(legend.title = element_blank())
# use ggarrange() to plot side by side
figure <- annotate_figure(ggarrange(ca_tg, tn_tg,
                   widths = c(1.35,1),
                   labels = c("California, 2021", 
                              "Tennessee, 2021"),
                   ncol = 2, nrow = 1),
                   top = text_grob("Proportion of Racial Groups Vaccinated Over Time", face = "bold", size = 18))
figure
```

Unfortunately, the datasets available on California and Tennessee vaccinations had different racial categories and fineness thereof. Regardless, there are important conclusions to draw from the data. It is clear that in both California and Tennessee, Black Americans received COVID-19 vaccinations at the lowest rate. This trend began from the beginning of vaccine administration in both cases, demonstrating a clear racial inequity for this group. 

Similarly, most other groups of people of color in California were vaccinated at rates below Caucasian Californians (except for Asian Californians and Native Hawaiian/Pacific Islander Californians). This suggests that Black and Brown communities encounter barriers to receiving vaccinations. Asian Californians appear to receive vaccines at similar rates to Caucasian Californians, which suggests a possibly less stark set of systemic barriers keeping Asian Californians from accessing the COVID-19 vaccine. Lastly, Native Hawaiian or Pacific Islander Californians appear to have consistently received the COVID-19 vaccine from the start. One theory for this occurrence is that Native Hawaiians whose tribal status is federally or regionally recognized may be able to receive the COVID-19 vaccine more easily via Indian Health Service vaccination clinics. However, this theory does not align with the low rates that non-Hawaiian Natives appear to be receiving vaccines.

In Tennessee, we also see a similar vaccination rate between Asian Tennesseeans and Caucasian Tennesseeans. This also suggests that Asian Tennesseeans encounter less stark systemic race-related barriers to COVID-19 vaccination. However, Black Tennesseeans appear to receive COVID-19 vaccinations at lower rates than their non-Black counterparts, which suggests that vaccine distribution between Black and non-Black communities in Tennessee is not equitable.

Lastly, it is important to note that in general, the overall vaccination rates in Tennessee are higher than in California. I theorize that this is because the Tennessee dataset did not specify whether vaccine counts meant fully vaccinated persons or vaccine doses administered, whereas the California dataset supplied counts of fully vaccinated persons. Since the overall purpose of this visualization was to compare rates between racial groups, and I believe that it is a fair assumption to say that racial groups and vaccine type (i.e. one-dose series or two-dose series) are not confounded, I hope that you all will find this visualization adequate.



```{r, echo = FALSE, message = FALSE}
# read in and plot ca county vaccinations
ca_county <- read_csv("ca_county.csv") %>%
  mutate(subregion = tolower(county)) %>%
  select(-county)
ca_counties <- map_data(map = "county", region = "california")
ca_map <- ca_counties %>%
  left_join(ca_county, by = "subregion")
ggplot(ca_map, aes(x = long, y = lat, group = group, fill = total_vax)) +
  geom_polygon(colour = "white") +
  theme_void() +
  coord_fixed(ratio = 1.3) +
  facet_wrap(~administered_date) +
  labs(fill = "Total Vaccinations") +
  scale_fill_viridis(direction = -1) +
  ggtitle("Vaccinations in California, Spring 2021")
```

The above graph shows the change in total vaccine doses in California between February 15 and April 15, 2021. I chose to analyze total doses instead of proportion of populations to demonstrate the incredibly high need for vaccine doses in highly populated areas, such as Los Angeles County (colored dark purple in the April 15 map). It appears that total doses administered falls highest in more populous counties, specifically those that encircle the Bay Area, Los Angeles, San Diego, Sacramento, and the Central Valley. If you look closely, you can see that the less populous counties saw a change in vaccine dosage between February 15 and April 15, but that that change is much smaller than the changes in populous areas. This can be explained by two main factors, the first (and most obvious) that vaccine counts should be lower where there are less people, and the second (and most important) that public health infrastructure in rural areas tends to be less thorough, presenting many access issues for agricultural communities, Native communities, elderly people, and other populations that live in rural areas.

```{r, echo = FALSE, message = FALSE}
# read in and plot tn county vaccinations
options(scipen = 999)
tn_county <- read_csv("tn_county.csv") %>%
  mutate(subregion = tolower(COUNTY)) %>%
  select(-COUNTY)
tn_counties <- map_data(map = "county", region = "tennessee")
tn_map <- tn_counties %>%
  left_join(tn_county, by = "subregion") %>%
  na.omit()
ggplot(tn_map, aes(x = long, y = lat, group = group, fill = total_vax)) +
  geom_polygon(colour = "white") +
  theme_void() +
  coord_fixed(ratio = 1.3) +
  facet_wrap(~date) +
  labs(fill = "Total Vaccinations") +
  scale_fill_viridis(direction = -1) +
  ggtitle("Vaccinations in Tennessee, Spring 2021")
```

## Bulleted list

You can make a bulleted list like this:

- item 1
- item 2
- item 3


## Numbered list

You can make a numbered list like this

1. First thing I want to say
2. Second thing I want to say
3. Third thing I want to say

# Politics and Vaccinations {.tabset .tabset-fade .tabset-pills}

## R Markdown

```{r}
#read in
ratios.1 <- read_csv("finalratios.csv")

#quick updates to dataset
ratios.2 <- ratios.1 %>%
  select(-c(X1)) %>%
  mutate(politics = case_when(dem_votes > rep_votes ~ "1", dem_votes < rep_votes ~ "0")) %>%
  mutate(ratio_overall = admin/delivered) %>%
  mutate(ratio_100 = admin_100/delivered_100)

#data for maps
usa_states <- map_data(map = "state", region = ".") 
ratio_map <- ratios.2 %>%
  right_join(usa_states, by = c("state" = "region"))

map_dem <- ratio_map %>%
  filter(politics != 0)
map_rep <- ratio_map %>%
  filter(politics != 1)
```

## Including Plots

You can also embed plots, for example:

```{r, echo=FALSE}
#overall vaccinated map
vax_overall_map <- ggplot(ratio_map, aes(x = long, y = lat, group = group
                      , fill = percent_full_18)) +
  geom_polygon(color = "white") +
  theme_void() +
  coord_fixed(ratio = 1.3) +
  theme(legend.position="bottom") +
  theme(text = element_text(size = 7)) +
  scale_fill_distiller(palette = "BuPu", direction = "horizantle") +
  labs(title = "Percent of Adults Who Are Fully Vaccinated", fill = "Percent")


#overall vaccine map
ratio_overall_map <- ggplot(ratio_map, aes(x = long, y = lat, group = group
                      , fill = ratio_overall)) +
  geom_polygon(color = "white") +
  theme_void() +
  coord_fixed(ratio = 1.3) +
  theme(legend.position="bottom") +
  theme(text = element_text(size = 7)) +
  scale_fill_distiller(palette = "BuPu", direction = "horizantle") +
  labs(title = "Ratio of Vaccines Received to Vaccines Administered", fill = "Ratio")

#combine
grid.arrange(vax_overall_map, ratio_overall_map, ncol=2)

#scatterplot
ggplot(ratios.2, aes(x=percent_full_18, y=ratio_overall)) + 
  geom_point() +
  geom_smooth(method="lm", se=TRUE, fullrange=FALSE) +
    labs(title = "Association Between % Vaccination and Administration", x = "Percent
         of 18+ Population Fully Vaccinated", y = "Ratio of Recieved/Admin Vaccines")

#political vaccine map
ggplot(ratio_map, aes(x = long, y = lat, group = group, fill = ratio_overall)) +
  coord_fixed(ratio = 1.3) +
  #republican
  geom_polygon(data = map_rep, color = "white") +
  theme_void() +
  labs(fill = "Republican Ratios") +
  theme(legend.position="bottom") +
  scale_fill_distiller(palette = "Reds", direction = "horizantle", breaks=c(0.7,0.8,0.9), limits=c(0.6,0.95)) +
  #democrat
  new_scale_fill() +
  scale_fill_distiller(palette = "PuBu", direction = "horizantle", breaks=c(0.7,0.8,0.9), limits=c(0.6,0.95)) +
  geom_polygon(data = map_dem, color = "white", aes(x = long, y = lat, group = group, fill = ratio_overall)) +
  labs(title = "Ratio of Vaccines Received to Vaccines Administered", subtitle = "Stratified by Politics (2020 Presidential Election
       Results)", fill = "Democratic Ratios") +
  theme(legend.position="bottom")

#boxplot
ratios.boxplot <- ratios.2 %>%
  mutate(politics = case_when(dem_votes > rep_votes ~ "Democrat", dem_votes < rep_votes ~ "Republican"))

ggplot(ratios.boxplot, aes(x=politics, y=ratio_overall)) + 
  geom_boxplot(outlier.colour="blue", outlier.shape=8, outlier.size=4) +
  labs(title = "Differential Vaccine Administration Ratios", subtitle = "Stratified by Politics (2020 Presidential Election Results)",
       y="Ratios of Doses Recieved to Administered", x = "2020 Election Results (Statewide)") +
  geom_jitter(shape=16, position=position_jitter(0))
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


# Tracking Statewide Vaccinations {.tabset .tabset-fade .tabset-pills}

